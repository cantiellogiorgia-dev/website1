<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Anatomy & Heart Simulation - Fixed</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { margin: 0; padding: 0; background-color: #050505; overflow: hidden; }
        canvas { display: block; }
    </style>
</head>
<body>

<script>
let bloodParticles = [];
let heartPulse = 0;
let skeletonASCII = [
    "      .-.      ",
    "     (o.o)     ",
    "      |=|      ",
    "     __|__     ",
    "   //  |  \\\\   ",
    "  //   |   \\\\  ",
    "  \\\\__/|\\__//  ",
    "       |       ",
    "      _|_      ",
    "     /   \\     ",
    "    /     \\    ",
    "    \\_    _/   "
];

// Coordinate mappate per seguire lo scheletro ASCII
let paths = {
    head:  [{x: 0, y: -90}, {x: 0, y: -180}, {x: 0, y: -90}],
    armL:  [{x: 0, y: -90}, {x: -80, y: -50}, {x: -120, y: 20}, {x: -80, y: -50}, {x: 0, y: -90}],
    armR:  [{x: 0, y: -90}, {x: 80, y: -50}, {x: 120, y: 20}, {x: 80, y: -50}, {x: 0, y: -90}],
    legL:  [{x: 0, y: 50}, {x: -40, y: 150}, {x: -50, y: 220}, {x: -40, y: 150}, {x: 0, y: 50}],
    legR:  [{x: 0, y: 50}, {x: 40, y: 150}, {x: 50, y: 220}, {x: 40, y: 150}, {x: 0, y: 50}]
};

function setup() {
    createCanvas(windowWidth, windowHeight);
    // Creiamo 100 particelle di sangue "H"
    for (let i = 0; i < 100; i++) {
        bloodParticles.push(new BloodH());
    }
}

function draw() {
    background(5);
    translate(width / 2, height / 2);

    // 1. DISEGNO DELLO SCHELETRO ASCII
    fill(150); 
    textAlign(CENTER, CENTER);
    textSize(24);
    textFont('monospace');
    for (let i = 0; i < skeletonASCII.length; i++) {
        text(skeletonASCII[i], 0, -180 + i * 35);
    }

    // 2. CUORE PULSANTE
    heartPulse = sin(frameCount * 0.1) * 5;
    fill(255, 0, 0);
    noStroke();
    // Posizionato al centro del petto dello scheletro
    ellipse(0, -60, 20 + heartPulse, 20 + heartPulse);

    // 3. MOVIMENTO DELLE H (SANGUE)
    for (let h of bloodParticles) {
        h.update();
        h.display();
    }
}

class BloodH {
    constructor() {
        this.init();
    }

    init() {
        let pathKeys = Object.keys(paths);
        this.currentPath = paths[random(pathKeys)];
        this.targetIdx = 1;
        // Parte dalla prima coordinata del percorso scelto
        this.pos = createVector(this.currentPath[0].x, this.currentPath[0].y);
        this.speed = random(1, 3);
    }

    update() {
        let target = this.currentPath[this.targetIdx];
        let targetVec = createVector(target.x, target.y);
        
        // Calcola direzione verso il prossimo punto del percorso
        let dir = p5.Vector.sub(targetVec, this.pos);
        
        if (dir.mag() < 5) {
            this.targetIdx++;
            if (this.targetIdx >= this.currentPath.length) {
                this.init(); // Ricomincia il ciclo dal cuore
            }
        }
        
        dir.setMag(this.speed);
        this.pos.add(dir);
    }

    display() {
        fill(255, 50, 50);
        noStroke();
        textSize(14);
        text("H", this.pos.x, this.pos.y);
    }
}

function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
}
</script>

</body>
</html>