<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0;
            background: #050505; 
            overflow: hidden; /* Impedisce lo scroll */
        }
        canvas {
            display: block;
            cursor: none; /* Nasconde il cursore per immersivit√† */
        }
    </style>
</head>
<body>

<script>
let circles = [];
let angle = 0;

function setup() {
    // Canvas a tutto schermo
    createCanvas(windowWidth, windowHeight);
}

// Gestisce il ridimensionamento della finestra
function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
}

function draw() {
    // Scia persistente molto morbida
    background(5, 5, 10, 20); 

    // Generazione continua basata sulla posizione del mouse
    // Rallentato per un effetto fluido
    for (let i = 0; i < 2; i++) {
        let r = angle * 1.5; 
        
        // SPIRALE 1: Sfumature di Grigio / Argento
        let x1 = mouseX + cos(angle) * r;
        let y1 = mouseY + sin(angle) * r;
        circles.push(new PsyCircle(x1, y1, angle, "gray"));
        
        // SPIRALE 2: Sfumature di Blu Oltremare (specchiata)
        let x2 = mouseX + cos(angle + PI) * r;
        let y2 = mouseY + sin(angle + PI) * r;
        circles.push(new PsyCircle(x2, y2, angle + PI, "ultramarine"));
        
        angle += 0.07; 
    }

    // Se il mouse non si muove, l'angolo torna gradualmente a zero per non "sparare" i cerchi troppo lontano
    if (!mouseIsPressed && pmouseX === mouseX && pmouseY === mouseY) {
        angle = lerp(angle, 0, 0.02);
    }

    // Disegno e aggiornamento
    for (let i = circles.length - 1; i >= 0; i--) {
        circles[i].update();
        circles[i].display();
        
        if (circles[i].isDead()) {
            circles.splice(i, 1);
        }
    }
}

class PsyCircle {
    constructor(x, y, a, type) {
        this.x = x;
        this.y = y;
        this.size = random(4, 18);
        this.alpha = 255;
        this.fadeSpeed = 2.2;
        this.type = type;
        this.angleRef = a;
        
        // Definizione colori
        if (this.type === "ultramarine") {
            // Gamma Blu Oltremare: variazioni tra (15, 10, 150) e (60, 100, 255)
            let b = map(sin(this.angleRef), -1, 1, 150, 255);
            let r = map(cos(this.angleRef), -1, 1, 10, 60);
            let g = map(sin(this.angleRef * 0.5), -1, 1, 20, 100);
            this.color = color(r, g, b);
        } else {
            // Gamma Grigio
            let g = map(sin(this.angleRef), -1, 1, 100, 220);
            this.color = color(g);
        }
    }

    update() {
        this.alpha -= this.fadeSpeed;
        this.size += 0.15;
    }

    display() {
        noStroke();
        // Applichiamo l'alpha al colore scelto
        let c = this.color;
        fill(red(c), green(c), blue(c), this.alpha);
        ellipse(this.x, this.y, this.size);
    }

    isDead() {
        return this.alpha <= 0;
    }
}
</script>

</body>
</html>