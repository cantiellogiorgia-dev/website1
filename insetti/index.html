<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCII Bug Squasher - Helvetica Walls</title>
    <style>
        body {
            margin: 0;
            background-color: #fff;
            color: #000;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-weight: bold;
            overflow: hidden;
            height: 100vh;
            cursor: crosshair;
            user-select: none;
        }

        #ui {
            position: absolute;
            top: 20px;
            right: 20px;
            text-align: right;
            z-index: 100;
        }

        .skull-mini {
            font-family: monospace;
            font-size: 14px;
            line-height: 1;
            margin-bottom: 5px;
        }

        #kills { font-size: 24px; }

        .bug {
            position: absolute;
            width: 30px;
            height: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            z-index: 10;
        }

        .dead-mark {
            position: absolute;
            color: #ff0000;
            font-size: 20px;
            font-family: monospace;
            font-weight: bold;
            pointer-events: none;
            z-index: 1;
        }

        .wall {
            position: absolute;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-weight: 900; /* Extra Bold per i muri */
            font-size: 18px;
            line-height: 0.9;
            color: #000;
            white-space: pre;
            pointer-events: none;
            transform: translate(-50%, -50%);
            z-index: 5;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>

<div id="ui">
    <div class="skull-mini">
     (x_x)
      -v-
    </div>
    <div id="kills">KILLED: 0</div>
</div>

<script>
    let killedCount = 0;
    const obstacles = [];
    const bugTypes = ['Ж', '«O»', 'vMv', '>>X'];

    // Struttura del muro in Helvetica Bold
    const wallArt = "#######\n#######\n#######";
    
    const cols = 3;
    const rows = 2;

    // Funzione per inizializzare i muri e i loro confini di collisione
    function setupWalls() {
        for (let i = 0; i < cols; i++) {
            for (let j = 0; j < rows; j++) {
                const wall = document.createElement('div');
                wall.className = 'wall';
                wall.innerText = wallArt;
                
                const x = (window.innerWidth / (cols + 1)) * (i + 1);
                const y = (window.innerHeight / (rows + 1)) * (j + 1);
                
                document.body.appendChild(wall);
                
                // Usiamo un timeout minimo per assicurarci che il browser abbia calcolato le dimensioni
                setTimeout(() => {
                    const rect = wall.getBoundingClientRect();
                    obstacles.push({ 
                        x: rect.left, 
                        y: rect.top, 
                        w: rect.width, 
                        h: rect.height 
                    });
                }, 50);
                
                wall.style.left = x + 'px';
                wall.style.top = y + 'px';
            }
        }
    }

    function createBug() {
        const el = document.createElement('div');
        el.className = 'bug';
        el.innerText = bugTypes[Math.floor(Math.random() * bugTypes.length)];
        document.body.appendChild(el);

        let x = Math.random() * (window.innerWidth - 50);
        let y = Math.random() * (window.innerHeight - 50);
        let angle = Math.random() * Math.PI * 2;
        
        let speed = 1.6 + Math.random() * 1.2; 
        let isDead = false;
        let hits = 0;

        function move() {
            if (isDead) return;

            let nextX = x + Math.cos(angle) * speed;
            let nextY = y + Math.sin(angle) * speed;

            // Logica di collisione migliorata
            for (let o of obstacles) {
                if (nextX < o.x + o.w && nextX + 25 > o.x && 
                    nextY < o.y + o.h && nextY + 25 > o.y) {
                    
                    // Rimbalzo fisico basato sulla direzione di impatto
                    if (x + 25 <= o.x || x >= o.x + o.w) {
                        angle = Math.PI - angle;
                    } else {
                        angle = -angle;
                    }
                    
                    angle += (Math.random() - 0.5) * 0.2; // Deviazione istintiva
                    nextX = x + Math.cos(angle) * speed;
                    nextY = y + Math.sin(angle) * speed;
                    break; 
                }
            }

            // Bordi schermo
            if (nextX < 0 || nextX > window.innerWidth - 30) angle = Math.PI - angle;
            if (nextY < 0 || nextY > window.innerHeight - 30) angle = -angle;

            x += Math.cos(angle) * speed;
            y += Math.sin(angle) * speed;
            
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            el.style.transform = `rotate(${angle + Math.PI/2}rad)`;

            requestAnimationFrame(move);
        }

        el.addEventListener('mousedown', () => {
            if (isDead) return;
            hits++;
            if (hits === 1) {
                el.style.color = "#aaa";
                speed *= 0.3;
            } else if (hits === 2) {
                isDead = true;
                killedCount++;
                document.getElementById('kills').innerText = `KILLED: ${killedCount}`;
                const mark = document.createElement('div');
                mark.className = 'dead-mark';
                mark.innerText = '###';
                mark.style.left = x + 'px';
                mark.style.top = y + 'px';
                mark.style.transform = `rotate(${angle}rad)`;
                document.body.appendChild(mark);
                el.remove();
            }
        });

        move();
    }

    // Avvio
    setupWalls();
    for(let i=0; i<18; i++) {
        setTimeout(createBug, i * 100);
    }

    setInterval(() => {
        if(document.querySelectorAll('.bug').length < 22) createBug();
    }, 1500);
</script>
</body>
</html>