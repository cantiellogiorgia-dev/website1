<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flower of Eyes - Interactive</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #ffffff; /* Sfondo bianco */
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>

<canvas id="canvas1"></canvas>

<script>
const canvas = document.getElementById('canvas1');
const ctx = canvas.getContext('2d');

// Impostiamo le dimensioni del canvas a tutto schermo
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let particleArray = [];
const mouse = {
    x: null,
    y: null,
    radius: 70 // Raggio d'azione del mouse aumentato per un effetto migliore
}

window.addEventListener('mousemove', function(event) {
    mouse.x = event.x;
    mouse.y = event.y;
});

class Eye {
    constructor(x, y) {
        this.x = x;
        this.y = y;
        this.size = 2.5; // Dimensione del puntino nero a riposo
    }

    draw() {
        let dx = mouse.x - this.x;
        let dy = mouse.y - this.y;
        let distance = Math.sqrt(dx * dx + dy * dy);

        if (distance < mouse.radius) {
            // --- STATO: OCCHIO APERTO ---
            
            // 1. Sfondo nero dell'occhio
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(this.x, this.y, 7, 0, Math.PI * 2);
            ctx.fill();

            // 2. Disegno "One Line" della palpebra (Bianca)
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 0.8;
            ctx.beginPath();
            // Angolo sinistro dell'occhio
            ctx.moveTo(this.x - 6, this.y); 
            // Curva superiore
            ctx.quadraticCurveTo(this.x, this.y - 7, this.x + 6, this.y); 
            // Curva inferiore
            ctx.quadraticCurveTo(this.x, this.y + 7, this.x - 6, this.y);
            ctx.stroke();

            // 3. Pupilla bianca al centro
            ctx.fillStyle = 'white';
            ctx.beginPath();
            ctx.arc(this.x, this.y, 1.8, 0, Math.PI * 2);
            ctx.fill();
            
        } else {
            // --- STATO: PUNTINO NERO (RIPOSO) ---
            ctx.fillStyle = 'black';
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }
}

const pngImage = new Image();
// PERCORSO IMMAGINE: Assicurati che sia corretto!
 img = "imag/fioreneero.png" 

pngImage.onload = function() {
    // Calcoliamo dove disegnare l'immagine per centrarla
    const startX = (canvas.width / 2) - (pngImage.width / 2);
    const startY = (canvas.height / 2) - (pngImage.height / 2);
    
    // Disegniamo temporaneamente l'immagine per estrarre i dati dei pixel
    ctx.drawImage(pngImage, startX, startY);
    
    try {
        const data = ctx.getImageData(startX, startY, pngImage.width, pngImage.height);
        ctx.clearRect(0, 0, canvas.width, canvas.height); // Puliamo il canvas per l'animazione

        particleArray = [];
        // Analizziamo i pixel: ogni 4 pixel per mantenere buone performance
        for (let y = 0; y < data.height; y += 4) {
            for (let x = 0; x < data.width; x += 4) {
                // Se l'opacità del pixel è superiore al 50% (pixel non trasparente)
                if (data.data[(y * 4 * data.width) + (x * 4) + 3] > 128) {
                    particleArray.push(new Eye(x + startX, y + startY));
                }
            }
        }
        console.log("Mappa caricata con successo. Numero di occhi:", particleArray.length);
        animate();
    } catch (err) {
        console.error("Errore di sicurezza (CORS): Apri il file con un server locale!", err);
    }
};

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    for (let i = 0; i < particleArray.length; i++) {
        particleArray[i].draw();
    }
    requestAnimationFrame(animate);
}

// Gestione ridimensionamento finestra
window.addEventListener('resize', function() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    // Nota: in un progetto reale dovresti ricaricare l'immagine qui 
    // o riposizionare le particelle esistenti.
});
</script>

</body>
</html>